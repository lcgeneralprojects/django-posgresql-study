{% extends "base.html" %}

{% block style %}
{% endblock style %}

{% block script %}
    <script type="text/javascript">
        $(document).on('submit', '#post-form', function (e) {
            e.preventDefault();
            $.ajax({
                type: 'POST',
                url: '{% url "post_create_norefresh" %}',
                data: {
                    title: $('#id_title').val(),
                    content: $('#id_content').val(),
                    csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
                },
                success: function (data) {
                    $('#postsDiv').load('#postsDiv > *');
                }
            })
        })
    </script> 
{% endblock script %}

{% block content %}
{% if request.user.is_authenticated %}
    <h1>Create Post</h1>
        <form id="post-form" method="POST">
            {% csrf_token %}
            {{ form.as_p }}
            {% comment %} <input type="submit" value="Save" /> {% endcomment %}
            <button type="submit">Save</button>
        </form>
    {% endif %}
<h1>My Posts</h1>
    <div class='postsDiv'>
        {% for post in posts %}
            <h2>{{ post.title }}</h2>
            <small>Published on {{ post.published_at | date:"M d, Y" }} by {{ post.author | title}}</small>
            <p>{{ post.content }}</p>

            {% if request.user.is_authenticated and request.user == post.author %}
            <p><a href="{% url 'post_edit' post.id %}">Edit</a></p>
            <p><a href="{% url 'post_delete' post.id %}">Delete</a></p>
            {% endif %}
        {% endfor %}
    </div>
{% endblock content %}